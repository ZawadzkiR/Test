import glob
import os
import re

def create_combined_readme(directory, output_file):
    # Wyszukaj wszystkie pliki README.md w katalogu i podkatalogach
    readme_files = glob.glob(os.path.join(directory, '**', 'README.md'), recursive=True)
    
    with open(output_file, 'w', encoding='utf-8') as outfile:
        # Na początku pliku dodajemy spis treści
        outfile.write("# Spis treści\n\n")
        
        # Zmienna do przechowywania już dodanych katalogów
        added_dirs = set()

        # Iteracja po wszystkich plikach README.md
        for readme in readme_files:
            # Uzyskaj katalog z pliku README.md
            directory_name = os.path.dirname(readme)
            
            # Stwórz unikalny identyfikator nagłówka dla katalogu (zastąp spacje i inne znaki specjalne)
            safe_directory_name = re.sub(r'[^a-zA-Z0-9]', '-', directory_name.lower())
            
            # Jeśli nie dodano jeszcze tego katalogu do spisu treści, dodaj go
            if directory_name not in added_dirs:
                # Dodaj link do spisu treści
                outfile.write(f"- [{directory_name}](#{safe_directory_name})\n")
                added_dirs.add(directory_name)
        
        # Dodaj separator
        outfile.write("\n---\n\n")
        
        # Iteracja po plikach README.md, aby dodać zawartość
        for readme in readme_files:
            directory_name = os.path.dirname(readme)
            
            # Stwórz unikalny identyfikator nagłówka dla katalogu
            safe_directory_name = re.sub(r'[^a-zA-Z0-9]', '-', directory_name.lower())
            
            # Dodaj nagłówek dla katalogu z odpowiednim identyfikatorem
            outfile.write(f"## {directory_name}  <a name='{safe_directory_name}'></a>\n\n")
            
            # Odczytaj zawartość pliku README.md
            with open(readme, 'r', encoding='utf-8') as infile:
                content = infile.read()
            
            # Dodaj zawartość pliku do wynikowego pliku README.md
            outfile.write(content)
            outfile.write("\n\n---\n\n")  # Dodajemy separator między plikami

    print(f"Plik {output_file} został utworzony.")

# Użycie funkcji
create_combined_readme('/ścieżka/do/katalogu', 'combined_README.md')
